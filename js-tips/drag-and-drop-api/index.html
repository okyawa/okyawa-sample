<!DOCTYPE HTML>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Drag and Drop APIのサンプル</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="author" content="okyawa">
  <meta name="robots" content="noindex">
  <link rel="stylesheet" href="/res/css/neat.css">

  <style>
    li {
      margin: 0.5rem 0;
      padding: 8px;
      border: 1px solid;
      cursor: grab;
    }
    .dragging {
      opacity: 0.5;
      cursor: grabbing;
    }
    .drag_over {
      border: 1px dashed;
    }
  </style>

</head>
<body>

  <header>
    <h1>HTML Drag and Drop APIのサンプル</h1>
  </header>

  <br />

  <section>
    <h2>HTML要素の並び替えサンプル</h2>

    <ol id="sortable_list">
      <li id="item_01">アイテム01</li>
      <li id="item_02">アイテム02</li>
      <li id="item_03">アイテム03</li>
      <li id="item_04">アイテム04</li>
    </ol>

    <script>
      /**
       * Drag and Drop APIを使った並び替えの初期化処理
       * 
       * @param {string} itemSelector
       */
      function setupDragAndDropElements(itemSelector) {
        // 並び替え対象の要素を取得
        const targetElements = document.querySelectorAll(itemSelector);
        targetElements.forEach((element) => {
          // 並び替え可能な要素には "draggable" 要素の指定が必要
          element.setAttribute('draggable', 'true');
          // Drag and Dropのイベントを登録
          setupDragAndDropEvent(element);
        });
      }

      /**
       * Drag and Dropのイベントを登録する
       * 
       * @param {HTMLElement} element 
       */
      function setupDragAndDropEvent(element) {
        const DRAGGING_CLASS_NAME = 'dragging';
        const DRAG_OVER_CLASS_NAME = 'drag_over';

        // ドラッグ開始時
        element.addEventListener('dragstart', (event) => {
          const draggedElement = event.currentTarget;
          draggedElement.classList.add(DRAGGING_CLASS_NAME);
          // ドラッグする要素の値をセット
          event.dataTransfer.setData('text/plain', draggedElement.id);
        });

        // ドラッグ中
        element.addEventListener('dragover', (event) => {
          event.preventDefault();
          const dragOveredElement = event.currentTarget;
          dragOveredElement.classList.add(DRAG_OVER_CLASS_NAME);
        });

        // ドラッグ項目が有効なドロップ対象を離れた場合
        element.addEventListener('dragleave', (event) => {
          const dragLeftElement = event.currentTarget;
          dragLeftElement.classList.remove(DRAG_OVER_CLASS_NAME);
        });

        // ドロップ時
        element.addEventListener('drop', (event) => {
          event.preventDefault();
          const droppedElement = event.currentTarget;
          droppedElement.classList.remove(DRAG_OVER_CLASS_NAME);
          // ドラッグ開始時にセットした値を取得
          const id = event.dataTransfer.getData('text/plain');
          // ドラッグした要素
          const draggedElement = document.getElementById(id);
          // ドラッグした要素をドロップした要素の前に挿入
          droppedElement.parentNode.insertBefore(draggedElement, droppedElement);
        });

        // ドラッグ終了時
        element.addEventListener('dragend', (event) => {
          const dragEndedElement = event.currentTarget;
          dragEndedElement.classList.remove(DRAGGING_CLASS_NAME);
        });
      }

      // 画面読み込み後に初期化処理を呼び出し
      window.addEventListener('DOMContentLoaded', () => {
        setupDragAndDropElements('#sortable_list li');
      });
    </script>

  </section>

</body>
</html>